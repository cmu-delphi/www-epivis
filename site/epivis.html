<!doctype html>
<!-- Made by David Farrow for interactive visualization of epidemiological data. -->
<html>
   <head>
      <title>EpiVis</title>
      <link type="text/css" rel="stylesheet" href="css/epivis.css">
      <link type="text/css" rel="stylesheet" href="css/treeview.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
      <link type="text/json" rel="manifest" href="manifest.json">
      <link type="image/png" rel="icon" sizes="192x192" href="icon.png">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/screenfull.js/3.0.2/screenfull.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.16.0/moment.min.js"></script>
      <script type="text/javascript" src="js/animate.js"></script>
      <script type="text/javascript" src="js/csv.js"></script>
      <script type="text/javascript" src="js/epivis.js"></script>
      <script type="text/javascript" src="js/treeview.js"></script>
      <script type="text/javascript" src="/epidata/lib/delphi_epidata.min.js"></script>
      <script type="text/javascript" src="js/epidata.js"></script>
      <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
      <meta name="mobile-web-app-capable" content="yes">
   </head>
   <body>
      <p class="info_text">[<a href="changelog.txt" target="_blank">v37</a>]</p>
      <div id="top_bar">
         <div id="file_csv" class="ui_flag ui_flag_icon"><i class="fa fa-folder-open"></i></div>
         <div id="file_api" class="ui_flag ui_flag_icon"><i class="fa fa-database"></i></div>
         <div id="file_draw" class="ui_flag ui_flag_icon"><i class="fa fa-pencil"></i></div>
         <div id="file_kernels" class="ui_flag ui_flag_icon"><i class="fa fa-code"></i></div>
         <div id="file_tree" class="ui_flag ui_flag_icon ui_flag_icon_selected"><i class="fa fa-list"></i></div>
         <div id="file_fullscreen" class="ui_flag ui_flag_icon" style="display: none;"><i class="fa fa-external-link-square"></i></div>
         <div class="spacer"></div>
         <div id="action_randomize" class="ui_flag ui_flag_icon"><i class="fa fa-paint-brush"></i></div>
         <div id="action_autoscale" class="ui_flag ui_flag_icon"><i class="fa fa-arrows-alt"></i></div>
         <div id="action_showpoints" class="ui_flag ui_flag_icon"><i class="fa fa-ellipsis-h"></i></div>
         <div id="action_multiscale" class="ui_flag ui_flag_icon"><i class="fa fa-anchor"></i></div>
         <div id="action_regress" class="ui_flag ui_flag_icon"><i class="fa fa-line-chart"></i></div>
         <div id="action_reset" class="ui_flag ui_flag_icon"><i class="fa fa-refresh"></i></div>
         <div id="action_screenshot" class="ui_flag ui_flag_icon"><i class="fa fa-picture-o"></i></div>
         <div id="action_undo" class="ui_flag ui_flag_icon ui_flag_icon_disabled"><i class="fa fa-undo"></i></div>
         <div id="action_redo" class="ui_flag ui_flag_icon ui_flag_icon_disabled"><i class="fa fa-repeat"></i></div>
         <div class="spacer"></div>
         <div id="navmode_pan" class="ui_flag ui_flag_icon ui_flag_icon_selected"><i class="fa fa-arrows"></i></div>
         <div id="navmode_crop" class="ui_flag ui_flag_icon"><i class="fa fa-crop"></i></div>
         <div id="navmode_zoom" class="ui_flag ui_flag_icon"><i class="fa fa-expand"></i></div>
      </div>
      <div id="chart_container" class="show_bottom">
         <div id="chart_tree"></div>
         <canvas id="chart_canvas" class="show_left" width="800" height="400" tabindex="1"></canvas>
      </div>
      <div id="tooltip" class="box_tooltip" style="display: none;"></div>
      <div id="box_overlay"></div>
      <div id="dialog_api" class="box_dialog">
         <h1>Load from Epidata API</h1>
         <div class="option_label"><label><input type="radio" name="source_radio" id="radio_fluview" checked="checked" /> FluView</label></div><span class="explanation">(source: <a target="_blank" href="https://gis.cdc.gov/grasp/fluview/fluportaldashboard.html">cdc.gov</a>)</span>
         <br />
         <div class="option_label"><label><input type="radio" name="source_radio" id="radio_flusurv" /> FluSurv</label></div><span class="explanation">(source: <a target="_blank" href="https://gis.cdc.gov/GRASP/Fluview/FluHospRates.html">cdc.gov</a>)</span>
         <br />
         <div class="option_label"><label><input type="radio" name="source_radio" id="radio_ilinet" /> ILINet</label></div><span class="explanation">(source: <a target="_blank" href="http://www.cdc.gov/flu/weekly/">cdc.gov</a> et al)</span>
         <br />
         <div class="option_label"><label><input type="radio" name="source_radio" id="radio_stateili" /> Imputed State ILI</label></div><span class="explanation">(source: <a target="_blank" href="http://delphi.midas.cs.cmu.edu/">delphi.midas.cs.cmu.edu</a>)</span>
         <br />
         <div class="option_label"><label><input type="radio" name="source_radio" id="radio_gft" /> Google Flu Trends</label></div><span class="explanation">(source: <a target="_blank" href="https://www.google.org/flutrends/">google.com</a>)</span>
         <br />
         <div class="option_label"><label><input type="radio" name="source_radio" id="radio_ght" /> Google Health Trends</label></div><span class="explanation">(source: private Google API)</span>
         <br />
         <div class="option_label"><label><input type="radio" name="source_radio" id="radio_twitter" /> HealthTweets</label></div><span class="explanation">(source: <a target="_blank" href="http://www.healthtweets.org/">healthtweets.org</a>)</span>
         <br />
         <div class="option_label"><label><input type="radio" name="source_radio" id="radio_wiki" /> Wikipedia Access</label></div><span class="explanation">(source: <a target="_blank" href="https://dumps.wikimedia.org/other/pagecounts-raw/">dumps.wikimedia.org</a>)</span>
         <br />
         <div class="option_label"><label><input type="radio" name="source_radio" id="radio_cdc" /> CDC Page Hits</label></div><span class="explanation">(source: private CDC dataset)</span>
         <br />
         <div class="option_label"><label><input type="radio" name="source_radio" id="radio_nidss_flu" /> NIDSS - Influenza</label></div><span class="explanation">(source: <a target="_blank" href="http://nidss.cdc.gov.tw/en/CDCWNH01.aspx?dc=wnh">nidss.cdc.gov.tw</a>)</span>
         <br />
         <div class="option_label"><label><input type="radio" name="source_radio" id="radio_nidss_dengue" /> NIDSS - Dengue</label></div><span class="explanation">(source: <a target="_blank" href="http://nidss.cdc.gov.tw/en/SingleDisease.aspx?dc=1&dt=4&disease=061&position=1">nidss.cdc.gov.tw</a>)</span>
         <br />
         <div class="option_label"><label><input type="radio" name="source_radio" id="radio_signals" /> Delphi Signals</label></div><span class="explanation">(source: <a target="_blank" href="http://delphi.midas.cs.cmu.edu/">delphi.midas.cs.cmu.edu</a>)</span>
         <br />
         <div class="option_label"><label><input type="radio" name="source_radio" id="radio_sensors" /> Delphi Sensors</label></div><span class="explanation">(source: <a target="_blank" href="http://delphi.midas.cs.cmu.edu/">delphi.midas.cs.cmu.edu</a>)</span>
         <br />
         <div class="option_label"><label><input type="radio" name="source_radio" id="radio_nowcast" /> Delphi Nowcast</label></div><span class="explanation">(source: <a target="_blank" href="http://delphi.midas.cs.cmu.edu/">delphi.midas.cs.cmu.edu</a>)</span>
         <div class="csv_options" id="radio_fluview_options">
            <div class="option_label">
               <select name="select_fluview_region" id="select_fluview_region">
                  <option value="nat" selected="selected">U.S. National</option>
                  <option value="hhs1">HHS Region 1</option>
                  <option value="hhs2">HHS Region 2</option>
                  <option value="hhs3">HHS Region 3</option>
                  <option value="hhs4">HHS Region 4</option>
                  <option value="hhs5">HHS Region 5</option>
                  <option value="hhs6">HHS Region 6</option>
                  <option value="hhs7">HHS Region 7</option>
                  <option value="hhs8">HHS Region 8</option>
                  <option value="hhs9">HHS Region 9</option>
                  <option value="hhs10">HHS Region 10</option>
                  <option value="cen1">Census Region 1</option>
                  <option value="cen2">Census Region 2</option>
                  <option value="cen3">Census Region 3</option>
                  <option value="cen4">Census Region 4</option>
                  <option value="cen5">Census Region 5</option>
                  <option value="cen6">Census Region 6</option>
                  <option value="cen7">Census Region 7</option>
                  <option value="cen8">Census Region 8</option>
                  <option value="cen9">Census Region 9</option>
               </select>
            </div><span class="explanation">(region to filter data by)</span>
            <br />
            <div class="option_label"><label><input type="radio" name="fluview_issue_radio" id="radio_fluview_recent" checked="checked" /> Most Recent Issue</label></div><span class="explanation">(fetch the most up-to-date/stable data)</span>
            <br />
            <div class="option_label"><label><input type="radio" name="fluview_issue_radio" id="radio_fluview_static" /> Specific Issue</label></div><span class="explanation">(fetch data "as-of" a specific week)</span>
            <br />
            <div class="option_label"><label><input type="radio" name="fluview_issue_radio" id="radio_fluview_offset" /> Lagged Issue</label></div><span class="explanation">(fetch data lagged by a number of weeks)</span>
            <br />
            <div class="csv_options" id="radio_fluview_recent_options">
               <span class="explanation">(this option has no additional parameters)</span>
               <br />
            </div>
            <div class="csv_options" id="radio_fluview_static_options" style="display: none;">
               <div class="option_label"><label><input type="text" id="text_fluview_static" value="201520" /> What MMWR week should the data come from?</label></div> <span class="explanation">(format: YYYYWW)</span>
               <br />
            </div>
            <div class="csv_options" id="radio_fluview_offset_options" style="display: none;">
               <div class="option_label"><label><input type="text" id="text_fluview_offset" value="0" /> How many weeks is the data lagged by?</label></div> <span class="explanation">(a non-negative integer)</span>
               <br />
            </div>
         </div>
         <div class="csv_options" id="radio_flusurv_options" style="display: none;">
            <div class="option_label">
               <select name="select_flusurv_location" id="select_flusurv_location">
                  <option value="network_all" selected="selected">Entire Network</option>
                  <option value="network_eip">EIP Netowrk</option>
                  <option value="network_ihsp">IHSP Network</option>
                  <option value="CA">CA</option>
                  <option value="CO">CO</option>
                  <option value="CT">CT</option>
                  <option value="GA">GA</option>
                  <option value="IA">IA</option>
                  <option value="ID">ID</option>
                  <option value="MD">MD</option>
                  <option value="MI">MI</option>
                  <option value="MN">MN</option>
                  <option value="NM">NM</option>
                  <option value="NY_albany">NY (Albany)</option>
                  <option value="NY_rochester">NY (Rochester)</option>
                  <option value="OH">OH</option>
                  <option value="OK">OK</option>
                  <option value="OR">OR</option>
                  <option value="RI">RI</option>
                  <option value="SD">SD</option>
                  <option value="TN">TN</option>
                  <option value="UT">UT</option>
               </select>
            </div><span class="explanation">(location to filter data by)</span>
            <br />
            <div class="option_label"><label><input type="radio" name="flusurv_issue_radio" id="radio_flusurv_recent" checked="checked" /> Most Recent Issue</label></div><span class="explanation">(fetch the most up-to-date/stable data)</span>
            <br />
            <div class="option_label"><label><input type="radio" name="flusurv_issue_radio" id="radio_flusurv_static" /> Specific Issue</label></div><span class="explanation">(fetch data "as-of" a specific week)</span>
            <br />
            <div class="option_label"><label><input type="radio" name="flusurv_issue_radio" id="radio_flusurv_offset" /> Lagged Issue</label></div><span class="explanation">(fetch data lagged by a number of weeks)</span>
            <br />
            <div class="csv_options" id="radio_flusurv_recent_options">
               <span class="explanation">(this option has no additional parameters)</span>
               <br />
            </div>
            <div class="csv_options" id="radio_flusurv_static_options" style="display: none;">
               <div class="option_label"><label><input type="text" id="text_flusurv_static" value="201520" /> What MMWR week should the data come from?</label></div> <span class="explanation">(format: YYYYWW)</span>
               <br />
            </div>
            <div class="csv_options" id="radio_flusurv_offset_options" style="display: none;">
               <div class="option_label"><label><input type="text" id="text_flusurv_offset" value="0" /> How many weeks is the data lagged by?</label></div> <span class="explanation">(a non-negative integer)</span>
               <br />
            </div>
         </div>
         <div class="csv_options" id="radio_ilinet_options" style="display: none;">
            <div class="option_label">
               <select name="select_ilinet_location" id="select_ilinet_location">
                  <option value="nat" selected="selected">U.S. National</option>
                  <option value="hhs1">HHS Region 1</option>
                  <option value="hhs2">HHS Region 2</option>
                  <option value="hhs3">HHS Region 3</option>
                  <option value="hhs4">HHS Region 4</option>
                  <option value="hhs5">HHS Region 5</option>
                  <option value="hhs6">HHS Region 6</option>
                  <option value="hhs7">HHS Region 7</option>
                  <option value="hhs8">HHS Region 8</option>
                  <option value="hhs9">HHS Region 9</option>
                  <option value="hhs10">HHS Region 10</option>
                  <option value="cen1">Census Region 1</option>
                  <option value="cen2">Census Region 2</option>
                  <option value="cen3">Census Region 3</option>
                  <option value="cen4">Census Region 4</option>
                  <option value="cen5">Census Region 5</option>
                  <option value="cen6">Census Region 6</option>
                  <option value="cen7">Census Region 7</option>
                  <option value="cen8">Census Region 8</option>
                  <option value="cen9">Census Region 9</option>
                  <option value="AK">AK</option>
                  <option value="AL">AL</option>
                  <option value="AR">AR</option>
                  <option value="AZ">AZ</option>
                  <option value="CA">CA</option>
                  <option value="CO">CO</option>
                  <option value="CT">CT</option>
                  <option value="DC">DC</option>
                  <option value="DE">DE</option>
                  <option value="FL">FL</option>
                  <option value="GA">GA</option>
                  <option value="HI">HI</option>
                  <option value="IA">IA</option>
                  <option value="ID">ID</option>
                  <option value="IL">IL</option>
                  <option value="IN">IN</option>
                  <option value="KS">KS</option>
                  <option value="KY">KY</option>
                  <option value="LA">LA</option>
                  <option value="MA">MA</option>
                  <option value="MD">MD</option>
                  <option value="ME">ME</option>
                  <option value="MI">MI</option>
                  <option value="MN">MN</option>
                  <option value="MO">MO</option>
                  <option value="MS">MS</option>
                  <option value="MT">MT</option>
                  <option value="NC">NC</option>
                  <option value="ND">ND</option>
                  <option value="NE">NE</option>
                  <option value="NH">NH</option>
                  <option value="NJ">NJ</option>
                  <option value="NM">NM</option>
                  <option value="NV">NV</option>
                  <option value="NY">NY</option>
                  <option value="OH">OH</option>
                  <option value="OK">OK</option>
                  <option value="OR">OR</option>
                  <option value="PA">PA</option>
                  <option value="RI">RI</option>
                  <option value="SC">SC</option>
                  <option value="SD">SD</option>
                  <option value="TN">TN</option>
                  <option value="TX">TX</option>
                  <option value="UT">UT</option>
                  <option value="VA">VA</option>
                  <option value="VT">VT</option>
                  <option value="WA">WA</option>
                  <option value="WI">WI</option>
                  <option value="WV">WV</option>
                  <option value="WY">WY</option>
               </select>
            </div><span class="explanation">(location to filter data by)</span>
            <br />
            <div class="option_label"><label><input type="radio" name="ilinet_version_radio" id="radio_ilinet_default_version" checked="checked" /> Scraped data: best estimate</label></div><span class="explanation">(average of all versions)</span>
            <br />
            <div class="option_label"><label><input type="radio" name="ilinet_version_radio" id="radio_ilinet_specific_version" /> Scraped data: specific version</label></div><span class="explanation">(fetch a specific version)</span>
            <br />
            <div class="csv_options" id="radio_ilinet_default_version_options">
               <span class="explanation">(this option has no additional parameters)</span>
               <br />
            </div>
            <div class="csv_options" id="radio_ilinet_specific_version_options" style="display: none;">
               <div class="option_label"><label><input type="text" id="text_ilinet_specific_version" value="1" /> Which version should be fetched?</label></div> <span class="explanation">("1" scraped on 2015w34, "2" scraped on 2016w21)</span>
               <br />
            </div>
            <div class="option_label">
               <input type="text" name="text_ilinet_auth" id="text_ilinet_auth" size="8" />
            </div><span class="explanation">(authorization token; required for state-level data provided by collaborating states' DoH via CDC; in any case, the API will return state-level ILI data scraped on a best-effort basis from states' public websites)</span>
            <br />
         </div>
         <div class="csv_options" id="radio_stateili_options" style="display: none;">
            <div class="option_label">
               <input type="text" name="text_stateili_auth" id="text_stateili_auth" size="8" />
            </div><span class="explanation">(authorization token)</span>
            <br />
            <div class="option_label">
               <select name="select_stateili_state" id="select_stateili_state">
                  <option value="AK" selected="selected">AK</option>
                  <option value="AL">AL</option>
                  <option value="AR">AR</option>
                  <option value="AZ">AZ</option>
                  <option value="CA">CA</option>
                  <option value="CO">CO</option>
                  <option value="CT">CT</option>
                  <option value="DC">DC</option>
                  <option value="DE">DE</option>
                  <option value="FL">FL</option>
                  <option value="GA">GA</option>
                  <option value="HI">HI</option>
                  <option value="IA">IA</option>
                  <option value="ID">ID</option>
                  <option value="IL">IL</option>
                  <option value="IN">IN</option>
                  <option value="KS">KS</option>
                  <option value="KY">KY</option>
                  <option value="LA">LA</option>
                  <option value="MA">MA</option>
                  <option value="MD">MD</option>
                  <option value="ME">ME</option>
                  <option value="MI">MI</option>
                  <option value="MN">MN</option>
                  <option value="MO">MO</option>
                  <option value="MS">MS</option>
                  <option value="MT">MT</option>
                  <option value="NC">NC</option>
                  <option value="ND">ND</option>
                  <option value="NE">NE</option>
                  <option value="NH">NH</option>
                  <option value="NJ">NJ</option>
                  <option value="NM">NM</option>
                  <option value="NV">NV</option>
                  <option value="NY">NY</option>
                  <option value="OH">OH</option>
                  <option value="OK">OK</option>
                  <option value="OR">OR</option>
                  <option value="PA">PA</option>
                  <option value="RI">RI</option>
                  <option value="SC">SC</option>
                  <option value="SD">SD</option>
                  <option value="TN">TN</option>
                  <option value="TX">TX</option>
                  <option value="UT">UT</option>
                  <option value="VA">VA</option>
                  <option value="VT">VT</option>
                  <option value="WA">WA</option>
                  <option value="WI">WI</option>
                  <option value="WV">WV</option>
                  <option value="WY">WY</option>
               </select>
            </div><span class="explanation">(location to filter data by)</span>
            <br />
         </div>
         <div class="csv_options" id="radio_gft_options" style="display: none;">
            <div class="option_label">
               <select name="select_gft_location" id="select_gft_location">
                  <option value="nat" selected="selected">U.S. National</option>
                  <option value="hhs1">HHS Region 1</option>
                  <option value="hhs2">HHS Region 2</option>
                  <option value="hhs3">HHS Region 3</option>
                  <option value="hhs4">HHS Region 4</option>
                  <option value="hhs5">HHS Region 5</option>
                  <option value="hhs6">HHS Region 6</option>
                  <option value="hhs7">HHS Region 7</option>
                  <option value="hhs8">HHS Region 8</option>
                  <option value="hhs9">HHS Region 9</option>
                  <option value="hhs10">HHS Region 10</option>
                  <option value="AK">AK</option>
                  <option value="AL">AL</option>
                  <option value="AR">AR</option>
                  <option value="AZ">AZ</option>
                  <option value="CA">CA</option>
                  <option value="CO">CO</option>
                  <option value="CT">CT</option>
                  <option value="DC">DC</option>
                  <option value="DE">DE</option>
                  <option value="FL">FL</option>
                  <option value="GA">GA</option>
                  <option value="HI">HI</option>
                  <option value="IA">IA</option>
                  <option value="ID">ID</option>
                  <option value="IL">IL</option>
                  <option value="IN">IN</option>
                  <option value="KS">KS</option>
                  <option value="KY">KY</option>
                  <option value="LA">LA</option>
                  <option value="MA">MA</option>
                  <option value="MD">MD</option>
                  <option value="ME">ME</option>
                  <option value="MI">MI</option>
                  <option value="MN">MN</option>
                  <option value="MO">MO</option>
                  <option value="MS">MS</option>
                  <option value="MT">MT</option>
                  <option value="NC">NC</option>
                  <option value="ND">ND</option>
                  <option value="NE">NE</option>
                  <option value="NH">NH</option>
                  <option value="NJ">NJ</option>
                  <option value="NM">NM</option>
                  <option value="NV">NV</option>
                  <option value="NY">NY</option>
                  <option value="OH">OH</option>
                  <option value="OK">OK</option>
                  <option value="OR">OR</option>
                  <option value="PA">PA</option>
                  <option value="RI">RI</option>
                  <option value="SC">SC</option>
                  <option value="SD">SD</option>
                  <option value="TN">TN</option>
                  <option value="TX">TX</option>
                  <option value="UT">UT</option>
                  <option value="VA">VA</option>
                  <option value="VT">VT</option>
                  <option value="WA">WA</option>
                  <option value="WI">WI</option>
                  <option value="WV">WV</option>
                  <option value="WY">WY</option>
                  <option value="Albany_NY">Albany, NY</option>
                  <option value="Albuquerque_NM">Albuquerque, NM</option>
                  <option value="Anchorage_AK">Anchorage, AK</option>
                  <option value="Arlington_VA">Arlington, VA</option>
                  <option value="Atlanta_GA">Atlanta, GA</option>
                  <option value="Austin_TX">Austin, TX</option>
                  <option value="Baltimore_MD">Baltimore, MD</option>
                  <option value="Baton_Rouge_LA">Baton Rouge, LA</option>
                  <option value="Beaverton_OR">Beaverton, OR</option>
                  <option value="Bellevue_WA">Bellevue, WA</option>
                  <option value="Berkeley_CA">Berkeley, CA</option>
                  <option value="Birmingham_AL">Birmingham, AL</option>
                  <option value="Boise_ID">Boise, ID</option>
                  <option value="Boston_MA">Boston, MA</option>
                  <option value="Buffalo_NY">Buffalo, NY</option>
                  <option value="Cary_NC">Cary, NC</option>
                  <option value="Charlotte_NC">Charlotte, NC</option>
                  <option value="Chicago_IL">Chicago, IL</option>
                  <option value="Cleveland_OH">Cleveland, OH</option>
                  <option value="Colorado_Springs_CO">Colorado Springs, CO</option>
                  <option value="Columbia_SC">Columbia, SC</option>
                  <option value="Columbus_OH">Columbus, OH</option>
                  <option value="Dallas_TX">Dallas, TX</option>
                  <option value="Dayton_OH">Dayton, OH</option>
                  <option value="Denver_CO">Denver, CO</option>
                  <option value="Des_Moines_IA">Des Moines, IA</option>
                  <option value="Durham_NC">Durham, NC</option>
                  <option value="Eugene_OR">Eugene, OR</option>
                  <option value="Fresno_CA">Fresno, CA</option>
                  <option value="Ft_Worth_TX">Ft Worth, TX</option>
                  <option value="Gainesville_FL">Gainesville, FL</option>
                  <option value="Grand_Rapids_MI">Grand Rapids, MI</option>
                  <option value="Greensboro_NC">Greensboro, NC</option>
                  <option value="Greenville_SC">Greenville, SC</option>
                  <option value="Honolulu_HI">Honolulu, HI</option>
                  <option value="Houston_TX">Houston, TX</option>
                  <option value="Indianapolis_IN">Indianapolis, IN</option>
                  <option value="Irvine_CA">Irvine, CA</option>
                  <option value="Irving_TX">Irving, TX</option>
                  <option value="Jacksonville_FL">Jacksonville, FL</option>
                  <option value="Jackson_MS">Jackson, MS</option>
                  <option value="Kansas_City_MO">Kansas City, MO</option>
                  <option value="Knoxville_TN">Knoxville, TN</option>
                  <option value="Las_Vegas_NV">Las Vegas, NV</option>
                  <option value="Lexington_KY">Lexington, KY</option>
                  <option value="Lincoln_NE">Lincoln, NE</option>
                  <option value="Little_Rock_AR">Little Rock, AR</option>
                  <option value="Los_Angeles_CA">Los Angeles, CA</option>
                  <option value="Lubbock_TX">Lubbock, TX</option>
                  <option value="Madison_WI">Madison, WI</option>
                  <option value="Memphis_TN">Memphis, TN</option>
                  <option value="Mesa_AZ">Mesa, AZ</option>
                  <option value="Miami_FL">Miami, FL</option>
                  <option value="Milwaukee_WI">Milwaukee, WI</option>
                  <option value="Nashville_TN">Nashville, TN</option>
                  <option value="Newark_NJ">Newark, NJ</option>
                  <option value="New_Orleans_LA">New Orleans, LA</option>
                  <option value="New_York_NY">New York, NY</option>
                  <option value="Norfolk_VA">Norfolk, VA</option>
                  <option value="Oakland_CA">Oakland, CA</option>
                  <option value="Oklahoma_City_OK">Oklahoma City, OK</option>
                  <option value="Omaha_NE">Omaha, NE</option>
                  <option value="Orlando_FL">Orlando, FL</option>
                  <option value="Philadelphia_PA">Philadelphia, PA</option>
                  <option value="Phoenix_AZ">Phoenix, AZ</option>
                  <option value="Pittsburgh_PA">Pittsburgh, PA</option>
                  <option value="Plano_TX">Plano, TX</option>
                  <option value="Portland_OR">Portland, OR</option>
                  <option value="Providence_RI">Providence, RI</option>
                  <option value="Raleigh_NC">Raleigh, NC</option>
                  <option value="Reno_NV">Reno, NV</option>
                  <option value="Reston_VA">Reston, VA</option>
                  <option value="Richmond_VA">Richmond, VA</option>
                  <option value="Rochester_NY">Rochester, NY</option>
                  <option value="Roswell_GA">Roswell, GA</option>
                  <option value="Sacramento_CA">Sacramento, CA</option>
                  <option value="Salt_Lake_City_UT">Salt Lake City, UT</option>
                  <option value="Santa_Clara_CA">Santa Clara, CA</option>
                  <option value="San_Antonio_TX">San Antonio, TX</option>
                  <option value="San_Diego_CA">San Diego, CA</option>
                  <option value="San_Francisco_CA">San Francisco, CA</option>
                  <option value="San_Jose_CA">San Jose, CA</option>
                  <option value="Scottsdale_AZ">Scottsdale, AZ</option>
                  <option value="Seattle_WA">Seattle, WA</option>
                  <option value="Somerville_MA">Somerville, MA</option>
                  <option value="Spokane_WA">Spokane, WA</option>
                  <option value="Springfield_MO">Springfield, MO</option>
                  <option value="State_College_PA">State College, PA</option>
                  <option value="St_Louis_MO">St Louis, MO</option>
                  <option value="St_Paul_MN">St Paul, MN</option>
                  <option value="Sunnyvale_CA">Sunnyvale, CA</option>
                  <option value="Tampa_FL">Tampa, FL</option>
                  <option value="Tempe_AZ">Tempe, AZ</option>
                  <option value="Tucson_AZ">Tucson, AZ</option>
                  <option value="Tulsa_OK">Tulsa, OK</option>
                  <option value="Washington_DC">Washington, DC</option>
                  <option value="Wichita_KS">Wichita, KS</option>
               </select>
            </div><span class="explanation">(location to filter data by)</span>
            <br />
         </div>
         <div class="csv_options" id="radio_ght_options" style="display: none;">
            <div class="option_label">
               <input type="text" name="text_ght_auth" id="text_ght_auth" size="8" />
            </div><span class="explanation">(authorization token)</span>
            <br />
            <div class="option_label">
               <select name="select_ght_location" id="select_ght_location">
                  <option value="US" selected="selected">U.S. National</option>
                  <option value="AK">AK</option>
                  <option value="AL">AL</option>
                  <option value="AR">AR</option>
                  <option value="AZ">AZ</option>
                  <option value="CA">CA</option>
                  <option value="CO">CO</option>
                  <option value="CT">CT</option>
                  <option value="DC">DC</option>
                  <option value="DE">DE</option>
                  <option value="FL">FL</option>
                  <option value="GA">GA</option>
                  <option value="HI">HI</option>
                  <option value="IA">IA</option>
                  <option value="ID">ID</option>
                  <option value="IL">IL</option>
                  <option value="IN">IN</option>
                  <option value="KS">KS</option>
                  <option value="KY">KY</option>
                  <option value="LA">LA</option>
                  <option value="MA">MA</option>
                  <option value="MD">MD</option>
                  <option value="ME">ME</option>
                  <option value="MI">MI</option>
                  <option value="MN">MN</option>
                  <option value="MO">MO</option>
                  <option value="MS">MS</option>
                  <option value="MT">MT</option>
                  <option value="NC">NC</option>
                  <option value="ND">ND</option>
                  <option value="NE">NE</option>
                  <option value="NH">NH</option>
                  <option value="NJ">NJ</option>
                  <option value="NM">NM</option>
                  <option value="NV">NV</option>
                  <option value="NY">NY</option>
                  <option value="OH">OH</option>
                  <option value="OK">OK</option>
                  <option value="OR">OR</option>
                  <option value="PA">PA</option>
                  <option value="RI">RI</option>
                  <option value="SC">SC</option>
                  <option value="SD">SD</option>
                  <option value="TN">TN</option>
                  <option value="TX">TX</option>
                  <option value="UT">UT</option>
                  <option value="VA">VA</option>
                  <option value="VT">VT</option>
                  <option value="WA">WA</option>
                  <option value="WI">WI</option>
                  <option value="WV">WV</option>
                  <option value="WY">WY</option>
               </select>
            </div><span class="explanation">(location to filter data by)</span>
            <br />
            <div class="option_label">
               <input type="text" name="text_ght_query" id="text_ght_query" />
            </div><span class="explanation">(search query or topic ID)</span>
            <br />
         </div>
         <div class="csv_options" id="radio_twitter_options" style="display: none;">
            <div class="option_label">
               <input type="text" name="text_twitter_auth" id="text_twitter_auth" size="8" />
            </div><span class="explanation">(authorization token)</span>
            <br />
            <div class="option_label">
               <select name="select_twitter_location" id="select_twitter_location">
                  <option value="nat" selected="selected">U.S. National</option>
                  <option value="hhs1">HHS Region 1</option>
                  <option value="hhs2">HHS Region 2</option>
                  <option value="hhs3">HHS Region 3</option>
                  <option value="hhs4">HHS Region 4</option>
                  <option value="hhs5">HHS Region 5</option>
                  <option value="hhs6">HHS Region 6</option>
                  <option value="hhs7">HHS Region 7</option>
                  <option value="hhs8">HHS Region 8</option>
                  <option value="hhs9">HHS Region 9</option>
                  <option value="hhs10">HHS Region 10</option>
                  <option value="cen1">Census Region 1</option>
                  <option value="cen2">Census Region 2</option>
                  <option value="cen3">Census Region 3</option>
                  <option value="cen4">Census Region 4</option>
                  <option value="cen5">Census Region 5</option>
                  <option value="cen6">Census Region 6</option>
                  <option value="cen7">Census Region 7</option>
                  <option value="cen8">Census Region 8</option>
                  <option value="cen9">Census Region 9</option>
                  <option value="AK">AK</option>
                  <option value="AL">AL</option>
                  <option value="AR">AR</option>
                  <option value="AZ">AZ</option>
                  <option value="CA">CA</option>
                  <option value="CO">CO</option>
                  <option value="CT">CT</option>
                  <option value="DC">DC</option>
                  <option value="DE">DE</option>
                  <option value="FL">FL</option>
                  <option value="GA">GA</option>
                  <option value="HI">HI</option>
                  <option value="IA">IA</option>
                  <option value="ID">ID</option>
                  <option value="IL">IL</option>
                  <option value="IN">IN</option>
                  <option value="KS">KS</option>
                  <option value="KY">KY</option>
                  <option value="LA">LA</option>
                  <option value="MA">MA</option>
                  <option value="MD">MD</option>
                  <option value="ME">ME</option>
                  <option value="MI">MI</option>
                  <option value="MN">MN</option>
                  <option value="MO">MO</option>
                  <option value="MS">MS</option>
                  <option value="MT">MT</option>
                  <option value="NC">NC</option>
                  <option value="ND">ND</option>
                  <option value="NE">NE</option>
                  <option value="NH">NH</option>
                  <option value="NJ">NJ</option>
                  <option value="NM">NM</option>
                  <option value="NV">NV</option>
                  <option value="NY">NY</option>
                  <option value="OH">OH</option>
                  <option value="OK">OK</option>
                  <option value="OR">OR</option>
                  <option value="PA">PA</option>
                  <option value="RI">RI</option>
                  <option value="SC">SC</option>
                  <option value="SD">SD</option>
                  <option value="TN">TN</option>
                  <option value="TX">TX</option>
                  <option value="UT">UT</option>
                  <option value="VA">VA</option>
                  <option value="VT">VT</option>
                  <option value="WA">WA</option>
                  <option value="WI">WI</option>
                  <option value="WV">WV</option>
                  <option value="WY">WY</option>
               </select>
            </div><span class="explanation">(location to filter data by)</span>
            <br />
            <div class="option_label">
               <select name="select_twitter_resolution" id="select_twitter_resolution">
                  <option value="daily" selected="selected">Daily</option>
                  <option value="weekly">Weekly</option>
               </select>
            </div><span class="explanation">(temporal resolution)</span>
            <br />
         </div>
         <div class="csv_options" id="radio_wiki_options" style="display: none;">
            <div class="option_label">
               <select name="select_wiki_article" id="select_wiki_article">
                  <option value="amantadine" selected="selected">amantadine</option>
                  <option value="antiviral_drugs">antiviral drugs</option>
                  <option value="avian_influenza">avian influenza</option>
                  <option value="canine_influenza">canine influenza</option>
                  <option value="cat_flu">cat flu</option>
                  <option value="chills">chills</option>
                  <option value="common_cold">common cold</option>
                  <option value="cough">cough</option>
                  <option value="equine_influenza">equine influenza</option>
                  <option value="fatigue_(medical)">fatigue (medical)</option>
                  <option value="fever">fever</option>
                  <option value="flu_season">flu season</option>
                  <option value="gastroenteritis">gastroenteritis</option>
                  <option value="headache">headache</option>
                  <option value="hemagglutinin_(influenza)">hemagglutinin (influenza)</option>
                  <option value="human_flu">human flu</option>
                  <option value="influenza">influenza</option>
                  <option value="influenzalike_illness">influenzalike illness</option>
                  <option value="influenzavirus_a">influenzavirus a</option>
                  <option value="influenzavirus_c">influenzavirus c</option>
                  <option value="influenza_a_virus">influenza a virus</option>
                  <option value="influenza_a_virus_subtype_h10n7">influenza a virus subtype h10n7</option>
                  <option value="influenza_a_virus_subtype_h1n1">influenza a virus subtype h1n1</option>
                  <option value="influenza_a_virus_subtype_h1n2">influenza a virus subtype h1n2</option>
                  <option value="influenza_a_virus_subtype_h2n2">influenza a virus subtype h2n2</option>
                  <option value="influenza_a_virus_subtype_h3n2">influenza a virus subtype h3n2</option>
                  <option value="influenza_a_virus_subtype_h3n8">influenza a virus subtype h3n8</option>
                  <option value="influenza_a_virus_subtype_h5n1">influenza a virus subtype h5n1</option>
                  <option value="influenza_a_virus_subtype_h7n2">influenza a virus subtype h7n2</option>
                  <option value="influenza_a_virus_subtype_h7n3">influenza a virus subtype h7n3</option>
                  <option value="influenza_a_virus_subtype_h7n7">influenza a virus subtype h7n7</option>
                  <option value="influenza_a_virus_subtype_h7n9">influenza a virus subtype h7n9</option>
                  <option value="influenza_a_virus_subtype_h9n2">influenza a virus subtype h9n2</option>
                  <option value="influenza_b_virus">influenza b virus</option>
                  <option value="influenza_pandemic">influenza pandemic</option>
                  <option value="influenza_prevention">influenza prevention</option>
                  <option value="influenza_vaccine">influenza vaccine</option>
                  <option value="malaise">malaise</option>
                  <option value="myalgia">myalgia</option>
                  <option value="nasal_congestion">nasal congestion</option>
                  <option value="nausea">nausea</option>
                  <option value="neuraminidase_inhibitor">neuraminidase inhibitor</option>
                  <option value="orthomyxoviridae">orthomyxoviridae</option>
                  <option value="oseltamivir">oseltamivir</option>
                  <option value="paracetamol">paracetamol</option>
                  <option value="rhinorrhea">rhinorrhea</option>
                  <option value="rimantadine">rimantadine</option>
                  <option value="shivering">shivering</option>
                  <option value="sore_throat">sore throat</option>
                  <option value="swine_influenza">swine influenza</option>
                  <option value="total">total</option>
                  <option value="viral_neuraminidase">viral neuraminidase</option>
                  <option value="viral_pneumonia">viral pneumonia</option>
                  <option value="vomiting">vomiting</option>
                  <option value="zanamivir">zanamivir</option>
               </select>
            </div><span class="explanation">(article to filter data by)</span>
            <br />
            <div class="option_label">
               <select name="select_wiki_resolution" id="select_wiki_resolution">
                  <option value="daily" selected="selected">Daily</option>
                  <option value="weekly">Weekly</option>
               </select>
            </div><span class="explanation">(temporal resolution)</span>
            <br />
            <div class="option_label"><label><input type="checkbox" id="check_wiki_hour" /> Specific Hour</label></div><span class="explanation">(filter by hour of day, otherwise return sum of all counts)</span>
            <br />
            <div class="csv_options" id="check_wiki_hour_options" style="display: none;">
               <label><input type="text" id="text_wiki_hour" value="0" /> Which hour should be used? <span class="explanation">(0-23, timezone is UTC)</span></label>
            </div>
            <br />
         </div>
         <br />
         <div class="csv_options" id="radio_cdc_options" style="display: none;">
            <div class="option_label">
               <input type="text" name="text_cdc_auth" id="text_cdc_auth" size="8" />
            </div><span class="explanation">(authorization token)</span>
            <br />
            <div class="option_label">
               <select name="select_cdc_location" id="select_cdc_location">
                  <option value="nat" selected="selected">U.S. National</option>
                  <option value="hhs1">HHS Region 1</option>
                  <option value="hhs2">HHS Region 2</option>
                  <option value="hhs3">HHS Region 3</option>
                  <option value="hhs4">HHS Region 4</option>
                  <option value="hhs5">HHS Region 5</option>
                  <option value="hhs6">HHS Region 6</option>
                  <option value="hhs7">HHS Region 7</option>
                  <option value="hhs8">HHS Region 8</option>
                  <option value="hhs9">HHS Region 9</option>
                  <option value="hhs10">HHS Region 10</option>
                  <option value="cen1">Census Region 1</option>
                  <option value="cen2">Census Region 2</option>
                  <option value="cen3">Census Region 3</option>
                  <option value="cen4">Census Region 4</option>
                  <option value="cen5">Census Region 5</option>
                  <option value="cen6">Census Region 6</option>
                  <option value="cen7">Census Region 7</option>
                  <option value="cen8">Census Region 8</option>
                  <option value="cen9">Census Region 9</option>
                  <option value="AK">AK</option>
                  <option value="AL">AL</option>
                  <option value="AR">AR</option>
                  <option value="AZ">AZ</option>
                  <option value="CA">CA</option>
                  <option value="CO">CO</option>
                  <option value="CT">CT</option>
                  <option value="DC">DC</option>
                  <option value="DE">DE</option>
                  <option value="FL">FL</option>
                  <option value="GA">GA</option>
                  <option value="HI">HI</option>
                  <option value="IA">IA</option>
                  <option value="ID">ID</option>
                  <option value="IL">IL</option>
                  <option value="IN">IN</option>
                  <option value="KS">KS</option>
                  <option value="KY">KY</option>
                  <option value="LA">LA</option>
                  <option value="MA">MA</option>
                  <option value="MD">MD</option>
                  <option value="ME">ME</option>
                  <option value="MI">MI</option>
                  <option value="MN">MN</option>
                  <option value="MO">MO</option>
                  <option value="MS">MS</option>
                  <option value="MT">MT</option>
                  <option value="NC">NC</option>
                  <option value="ND">ND</option>
                  <option value="NE">NE</option>
                  <option value="NH">NH</option>
                  <option value="NJ">NJ</option>
                  <option value="NM">NM</option>
                  <option value="NV">NV</option>
                  <option value="NY">NY</option>
                  <option value="OH">OH</option>
                  <option value="OK">OK</option>
                  <option value="OR">OR</option>
                  <option value="PA">PA</option>
                  <option value="RI">RI</option>
                  <option value="SC">SC</option>
                  <option value="SD">SD</option>
                  <option value="TN">TN</option>
                  <option value="TX">TX</option>
                  <option value="UT">UT</option>
                  <option value="VA">VA</option>
                  <option value="VT">VT</option>
                  <option value="WA">WA</option>
                  <option value="WI">WI</option>
                  <option value="WV">WV</option>
                  <option value="WY">WY</option>
               </select>
            </div><span class="explanation">(location to filter data by)</span>
         </div>
         <br />
         <div class="csv_options" id="radio_nidss_flu_options" style="display: none;">
            <div class="option_label">
               <select name="select_nidss_flu_region" id="select_nidss_flu_region">
                  <option value="nationwide" selected="selected">Taiwan National</option>
                  <option value="central">Central</option>
                  <option value="eastern">Eastern</option>
                  <option value="kaoping">Kaoping</option>
                  <option value="northern">Northern</option>
                  <option value="southern">Southern</option>
                  <option value="taipei">Taipei</option>
               </select>
            </div><span class="explanation">(region to filter data by)</span>
            <br />
            <div class="option_label"><label><input type="radio" name="nidss_flu_issue_radio" id="radio_nidss_flu_recent" checked="checked" /> Most Recent Issue</label></div><span class="explanation">(fetch the most up-to-date/stable data)</span>
            <br />
            <div class="option_label"><label><input type="radio" name="nidss_flu_issue_radio" id="radio_nidss_flu_static" /> Specific Issue</label></div><span class="explanation">(fetch data "as-of" a specific week)</span>
            <br />
            <div class="option_label"><label><input type="radio" name="nidss_flu_issue_radio" id="radio_nidss_flu_offset" /> Lagged Issue</label></div><span class="explanation">(fetch data lagged by a number of weeks)</span>
            <br />
            <div class="csv_options" id="radio_nidss_flu_recent_options">
               <span class="explanation">(this option has no additional parameters)</span>
               <br />
            </div>
            <div class="csv_options" id="radio_nidss_flu_static_options" style="display: none;">
               <div class="option_label"><label><input type="text" id="text_nidss_flu_static" value="201530" /> What week was the data published?</label></div> <span class="explanation">(format: YYYYWW)</span>
               <br />
            </div>
            <div class="csv_options" id="radio_nidss_flu_offset_options" style="display: none;">
               <div class="option_label"><label><input type="text" id="text_nidss_flu_offset" value="1" /> How many weeks is the data lagged by?</label></div> <span class="explanation">(a positive integer)</span>
               <br />
            </div>
         </div>
         <div class="csv_options" id="radio_nidss_dengue_options" style="display: none;">
            <div class="option_label">
               <select name="select_nidss_dengue_location" id="select_nidss_dengue_location">
                  <option value="nationwide" selected="selected">Taiwan National</option>
                  <option value="central">Central</option>
                  <option value="eastern">Eastern</option>
                  <option value="kaoping">Kaoping</option>
                  <option value="northern">Northern</option>
                  <option value="southern">Southern</option>
                  <option value="taipei">Taipei</option>
                  <option value="changhua_county">Changhua County</option>
                  <option value="chiayi_city">Chiayi City</option>
                  <option value="chiayi_county">Chiayi County</option>
                  <option value="hsinchu_city">Hsinchu City</option>
                  <option value="hsinchu_county">Hsinchu County</option>
                  <option value="hualien_county">Hualien County</option>
                  <option value="kaohsiung_city">Kaohsiung City</option>
                  <option value="keelung_city">Keelung City</option>
                  <option value="kinmen_county">Kinmen County</option>
                  <option value="lienchiang_county">Lienchiang County</option>
                  <option value="miaoli_county">Miaoli County</option>
                  <option value="nantou_county">Nantou County</option>
                  <option value="new_taipei_city">New taipei City</option>
                  <option value="penghu_county">Penghu County</option>
                  <option value="pingtung_county">Pingtung County</option>
                  <option value="taichung_city">Taichung City</option>
                  <option value="tainan_city">Tainan City</option>
                  <option value="taipei_city">Taipei City</option>
                  <option value="taitung_county">Taitung County</option>
                  <option value="taoyuan_city">Taoyuan City</option>
                  <option value="yilan_county">Yilan County</option>
                  <option value="yunlin_county">Yunlin County</option>
               </select>
            </div><span class="explanation">(location to filter data by)</span>
         </div>
         <br />
         <div class="csv_options" id="radio_signals_options" style="display: none;">
            <div class="option_label">
               <input type="text" name="text_signals_auth" id="text_signals_auth" size="8" />
            </div><span class="explanation">(authorization token)</span>
            <br />
            <div class="option_label">
               <select name="select_signals_name" id="select_signals_name">
                  <option value="twitter" selected="selected">twitter</option>
                  <option value="wiki">wiki</option>
                  <option value="uili">uili</option>
                  <option value="ght">ght</option>
                  <option value="gft">gft</option>
               </select>
            </div><span class="explanation">(data source from which signal is built)</span>
            <br />
            <div class="option_label">
               <select name="select_signals_location" id="select_signals_location">
                  <option value="nat" selected="selected">U.S. National</option>
                  <option value="hhs1">HHS Region 1</option>
                  <option value="hhs2">HHS Region 2</option>
                  <option value="hhs3">HHS Region 3</option>
                  <option value="hhs4">HHS Region 4</option>
                  <option value="hhs5">HHS Region 5</option>
                  <option value="hhs6">HHS Region 6</option>
                  <option value="hhs7">HHS Region 7</option>
                  <option value="hhs8">HHS Region 8</option>
                  <option value="hhs9">HHS Region 9</option>
                  <option value="hhs10">HHS Region 10</option>
               </select>
            </div><span class="explanation">(location to filter data by)</span>
         </div>
         <br />
         <div class="csv_options" id="radio_sensors_options" style="display: none;">
            <div class="option_label">
               <input type="text" name="text_sensors_auth" id="text_sensors_auth" size="8" />
            </div><span class="explanation">(authorization token)</span>
            <br />
            <div class="option_label">
               <select name="select_sensors_name" id="select_sensors_name">
                  <option value="gft" selected="selected">gft</option>
                  <option value="ght">ght</option>
                  <option value="twtr">twtr</option>
                  <option value="wiki">wiki</option>
                  <option value="cdc">cdc</option>
                  <option value="epic">epic</option>
                  <option value="sar3">sar3</option>
                  <option value="arch">arch</option>
               </select>
            </div><span class="explanation">(data source from which signal is built)</span>
            <br />
            <div class="option_label">
               <select name="select_sensors_location" id="select_sensors_location">
                  <option value="nat" selected="selected">U.S. National</option>
                  <option value="hhs1">HHS Region 1</option>
                  <option value="hhs2">HHS Region 2</option>
                  <option value="hhs3">HHS Region 3</option>
                  <option value="hhs4">HHS Region 4</option>
                  <option value="hhs5">HHS Region 5</option>
                  <option value="hhs6">HHS Region 6</option>
                  <option value="hhs7">HHS Region 7</option>
                  <option value="hhs8">HHS Region 8</option>
                  <option value="hhs9">HHS Region 9</option>
                  <option value="hhs10">HHS Region 10</option>
                  <option value="cen1">Census Region 1</option>
                  <option value="cen2">Census Region 2</option>
                  <option value="cen3">Census Region 3</option>
                  <option value="cen4">Census Region 4</option>
                  <option value="cen5">Census Region 5</option>
                  <option value="cen6">Census Region 6</option>
                  <option value="cen7">Census Region 7</option>
                  <option value="cen8">Census Region 8</option>
                  <option value="cen9">Census Region 9</option>
                  <option value="AK">AK</option>
                  <option value="AL">AL</option>
                  <option value="AR">AR</option>
                  <option value="AZ">AZ</option>
                  <option value="CA">CA</option>
                  <option value="CO">CO</option>
                  <option value="CT">CT</option>
                  <option value="DC">DC</option>
                  <option value="DE">DE</option>
                  <option value="FL">FL</option>
                  <option value="GA">GA</option>
                  <option value="HI">HI</option>
                  <option value="IA">IA</option>
                  <option value="ID">ID</option>
                  <option value="IL">IL</option>
                  <option value="IN">IN</option>
                  <option value="KS">KS</option>
                  <option value="KY">KY</option>
                  <option value="LA">LA</option>
                  <option value="MA">MA</option>
                  <option value="MD">MD</option>
                  <option value="ME">ME</option>
                  <option value="MI">MI</option>
                  <option value="MN">MN</option>
                  <option value="MO">MO</option>
                  <option value="MS">MS</option>
                  <option value="MT">MT</option>
                  <option value="NC">NC</option>
                  <option value="ND">ND</option>
                  <option value="NE">NE</option>
                  <option value="NH">NH</option>
                  <option value="NJ">NJ</option>
                  <option value="NM">NM</option>
                  <option value="NV">NV</option>
                  <option value="NY">NY</option>
                  <option value="OH">OH</option>
                  <option value="OK">OK</option>
                  <option value="OR">OR</option>
                  <option value="PA">PA</option>
                  <option value="RI">RI</option>
                  <option value="SC">SC</option>
                  <option value="SD">SD</option>
                  <option value="TN">TN</option>
                  <option value="TX">TX</option>
                  <option value="UT">UT</option>
                  <option value="VA">VA</option>
                  <option value="VT">VT</option>
                  <option value="WA">WA</option>
                  <option value="WI">WI</option>
                  <option value="WV">WV</option>
                  <option value="WY">WY</option>
               </select>
            </div><span class="explanation">(location to filter data by)</span>
         </div>
         <br />
         <div class="csv_options" id="radio_nowcast_options" style="display: none;">
            <div class="option_label">
               <select name="select_nowcast_location" id="select_nowcast_location">
                  <option value="nat" selected="selected">U.S. National</option>
                  <option value="hhs1">HHS Region 1</option>
                  <option value="hhs2">HHS Region 2</option>
                  <option value="hhs3">HHS Region 3</option>
                  <option value="hhs4">HHS Region 4</option>
                  <option value="hhs5">HHS Region 5</option>
                  <option value="hhs6">HHS Region 6</option>
                  <option value="hhs7">HHS Region 7</option>
                  <option value="hhs8">HHS Region 8</option>
                  <option value="hhs9">HHS Region 9</option>
                  <option value="hhs10">HHS Region 10</option>
                  <option value="cen1">Census Region 1</option>
                  <option value="cen2">Census Region 2</option>
                  <option value="cen3">Census Region 3</option>
                  <option value="cen4">Census Region 4</option>
                  <option value="cen5">Census Region 5</option>
                  <option value="cen6">Census Region 6</option>
                  <option value="cen7">Census Region 7</option>
                  <option value="cen8">Census Region 8</option>
                  <option value="cen9">Census Region 9</option>
                  <option value="AK">AK</option>
                  <option value="AL">AL</option>
                  <option value="AR">AR</option>
                  <option value="AZ">AZ</option>
                  <option value="CA">CA</option>
                  <option value="CO">CO</option>
                  <option value="CT">CT</option>
                  <option value="DC">DC</option>
                  <option value="DE">DE</option>
                  <option value="FL">FL</option>
                  <option value="GA">GA</option>
                  <option value="HI">HI</option>
                  <option value="IA">IA</option>
                  <option value="ID">ID</option>
                  <option value="IL">IL</option>
                  <option value="IN">IN</option>
                  <option value="KS">KS</option>
                  <option value="KY">KY</option>
                  <option value="LA">LA</option>
                  <option value="MA">MA</option>
                  <option value="MD">MD</option>
                  <option value="ME">ME</option>
                  <option value="MI">MI</option>
                  <option value="MN">MN</option>
                  <option value="MO">MO</option>
                  <option value="MS">MS</option>
                  <option value="MT">MT</option>
                  <option value="NC">NC</option>
                  <option value="ND">ND</option>
                  <option value="NE">NE</option>
                  <option value="NH">NH</option>
                  <option value="NJ">NJ</option>
                  <option value="NM">NM</option>
                  <option value="NV">NV</option>
                  <option value="NY">NY</option>
                  <option value="OH">OH</option>
                  <option value="OK">OK</option>
                  <option value="OR">OR</option>
                  <option value="PA">PA</option>
                  <option value="RI">RI</option>
                  <option value="SC">SC</option>
                  <option value="SD">SD</option>
                  <option value="TN">TN</option>
                  <option value="TX">TX</option>
                  <option value="UT">UT</option>
                  <option value="VA">VA</option>
                  <option value="VT">VT</option>
                  <option value="WA">WA</option>
                  <option value="WI">WI</option>
                  <option value="WV">WV</option>
                  <option value="WY">WY</option>
               </select>
            </div><span class="explanation">(location to filter data by)</span>
         </div>
         <br />
         <input type="button" id="button_import_api" value="Fetch Data" />
      </div>
      <div id="dialog_csv" class="box_dialog">
         <h1>Load from CSV File</h1>
         <label><input type="file" id="file_local" /> Select Local File</label>
         <br />
         <textarea id="preview_box" placeholder="Select a file above to preview its contents." readonly="readonly" rows="5" wrap="off" style="width: 100%;"></textarea>
         <br />
         <div class="option_label"><label><input type="checkbox" id="check_transpose" /> Transpose</label></div><span class="explanation">(treat rows as columns and vice versa)</span>
         <br />
         <div class="option_label"><label><input type="checkbox" id="check_header" checked="checked" /> Has Header Row</label></div><span class="explanation">(extract column names, then discard first row)</span>
         <br />
         <div class="option_label"><label><input type="checkbox" id="check_date" checked="checked" /> Has Date Column</label></div><span class="explanation">(otherwise assume daily starting on 2000-01-01)</span>
         <div class="csv_options" id="check_date_options">
            <div class="option_label"><label><input type="radio" name="date_radio" id="radio_simple" checked="checked" /> Date String</label></div><span class="explanation">(format: YYYY-MM-DD; ex: 2015-05-02)</span>
            <br />
            <div class="option_label"><label><input type="radio" name="date_radio" id="radio_epiweek" /> Epiweek</label></div><span class="explanation">(format: YYYYWW; ex: 201522)</span>
            <br />
            <div class="option_label"><label><input type="radio" name="date_radio" id="radio_epi" /> Epi Week</label></div><span class="explanation">(format: YYYY, WW; ex: 2015, 22)</span>
            <br />
            <div class="option_label"><label><input type="radio" name="date_radio" id="radio_decimal" /> Decimal Date</label></div><span class="explanation">(format: YYYY.YYY; ex: 2015.456)</span>
            <br />
            <div class="option_label"><label><input type="radio" name="date_radio" id="radio_monthly" /> Monthly Data</label></div><span class="explanation">(format: YYYY, MM; ex: 2015, 05)</span>
            <br /><span class="explanation">(all columns are zero-indexed)</span>
            <div class="csv_options" id="radio_simple_options">
               <label><input type="text" id="text_simple_0" value="0" /> Which column contains dates?</label>
            </div>
            <div class="csv_options" id="radio_epiweek_options" style="display: none;">
               <label><input type="text" id="text_epiweek_0" value="0" /> Which column contains the epiweek?</label>
            </div>
            <div class="csv_options" id="radio_epi_options" style="display: none;">
               <label><input type="text" id="text_epi_0" value="2" /> Which column contains the epi year?</label>
               <br />
               <label><input type="text" id="text_epi_1" value="3" /> Which column contains the epi week?</label>
            </div>
            <div class="csv_options" id="radio_decimal_options" style="display: none;">
               <label><input type="text" id="text_decimal_0" value="0" /> Which column contains dates?</label>
            </div>
            <div class="csv_options" id="radio_monthly_options" style="display: none;">
               <label><input type="text" id="text_monthly_0" value="0" /> Which column contains the year?</label>
               <br />
               <label><input type="text" id="text_monthly_1" value="1" /> Which column contains the month?</label>
            </div>
         </div>
         <br />
         <div class="option_label"><label><input type="checkbox" id="check_group" /> Group By</label></div><span class="explanation">(for when multiple overlapping time series are in the same file; ex: FluView Regional data)</span>
         <div class="csv_options" id="check_group_options" style="display: none;">
            <label><input type="text" id="text_group_0" value="1" /> Which column should be grouped?</label>
         </div>
         <br />
         <br />
         <input type="button" id="button_import_csv" value="Import CSV" />
      </div>
      <div id="dialog_draw" class="box_dialog">
         <h1>Add Custom Line</h1>
         <div class="option_label"><label><input type="text" name="draw_title" id="draw_title" value="My Line" /> Descriptive Name</label></div><span class="explanation">(short string)</span>
         <br />
         <br />
         <div class="option_label"><label><input type="text" name="draw_date1" id="draw_date1" size="10" maxlength="10" value="2014-01-01" /> Start Date</label></div><span class="explanation">(format is YYYY-MM-DD or YYYYWW)</span>
         <br />
         <div class="option_label"><label><input type="text" name="draw_value1" id="draw_value1" size="10" maxlength="10" value="0" /> Start Value</label></div><span class="explanation">(any floating point number)</span>
         <br />
         <br />
         <div class="option_label"><label><input type="text" name="draw_date2" id="draw_date2" size="10" maxlength="10" value="2015-01-01" /> End Date</label></div><span class="explanation">(format is YYYY-MM-DD or YYYYWW)</span>
         <br />
         <div class="option_label"><label><input type="text" name="draw_value2" id="draw_value2" size="10" maxlength="10" value="1" /> End Value</label></div><span class="explanation">(any floating point number)</span>
         <br />
         <br /><span class="explanation">Tip: you can make a vertical line by using the same date at both endpoints!</span><br />
         <br />
         <input type="button" id="button_draw_line" value="Draw Line" />
      </div>
      <div id="dialog_kernels" class="box_dialog">
         <h1>Create a new Dataset</h1>
         <b>Select Inputs</b><br>
         In the tree to the left, select (by checking) the datasets to start with. How many you select depends on the function you want to apply.<br>
         <br>
         <b>Open the developer console</b><br>
         In chrome, the keyboard shortcut is Ctrl+Shift+J<br>
         <br>
         <b>Call the function <i>createDataset</i></b><br>
         The function accepts two parameters: a name for the output dataset, and a function to apply to the selected dataset(s).<br>
         <br>
         <b>Available Functions ("Kernels")</b><br>
         <i>Kernels.sum</i>, <i>Kernels.product</i>, <i>Kernels.average</i><br>
         Selected Datasets: 1 or more<br>
         Kernel Parameters: none<br>
         Action: Calculates the sum, product, or average of the selected datasets.<br>
         <br>
         <i>Kernels.iliplus</i><br>
         Selected Datasets: 2<br>
         Kernel Parameters: none<br>
         Action: Calculates the product, divided by 100, of the selected datasets. (Intended for 'wILI' and '%positive' datasets.)<br>
         <br>
         <i>Kernels.scale</i><br>
         Selected Datasets: 1<br>
         Kernel Parameters: <i>scale</i><br>
         Action: Scales the selected dataset by the provided <i>scale</i> parameter.<br>
         <br>
         <i>Kernels.ratio</i><br>
         Selected Datasets: 2<br>
         Kernel Parameters: <i>inverse</i> (optional)<br>
         Action: Calculates the quotient of the selected datasets. (Flips numerator and denominator if <i>inverse</i> is true.)<br>
         <br>
         <b>Examples</b><br>
         Compute ILI+: <i>createDataset('ILI+', Kernels.iliplus())</i><br>
         Scale GFT by 1/1000: <i>createDataset('GFT/1000', Kernels.scale(0.001))</i><br>
         Take the average: <i>createDataset('avg', Kernels.average())</i>
         <br>
      </div>
      <div id="dialog_regress" class="box_dialog" style="height:auto;">
         <h2>Run regression</h2>
         <span class="option_label" id="regress_dropdown_title" style="font-size:16px">Regression target selection:</span>
         <div id="regress_dropdown_wrapper" style="display:inline" >
            <select id="regress_dropdown">
            </select>
         </div>
         <input type="button" id="button_run_regression" value="Run" style="margin-bottom:30px"/>
      </div>
      <script type="text/javascript">
         var chart;
         var tree;
         var currentDialog = null;
         function run() {
            // chart setup
            chart = new EpiVis.Chart('chart_canvas', chartListener);
            tree = new TreeView.TreeView('chart_tree');
            // interface setup
            $('#file_local').change(function() { loadFile(previewFile); });
            $('#button_import_csv').click(function() { loadFile(parseFile); });
            $('#button_import_api').click(function() { loadEpidata(); });
            $('#button_draw_line').click(function() { addCustomLine(); });
            $('#button_run_regression').click(function() { runRegression($( "#regress_dropdown" ).val()); });
            $('#box_overlay').click(function() { closeDialog(); });
            connectSubOptions(['radio_simple', 'radio_epiweek', 'radio_epi', 'radio_decimal', 'radio_monthly']);
            connectSubOptions(['radio_fluview', 'radio_flusurv', 'radio_ilinet', 'radio_stateili', 'radio_gft', 'radio_ght', 'radio_twitter', 'radio_wiki', 'radio_nidss_flu', 'radio_nidss_dengue', 'radio_signals', 'radio_cdc', 'radio_sensors', 'radio_nowcast']);
            connectSubOptions(['radio_fluview_recent', 'radio_fluview_static', 'radio_fluview_offset']);
            connectSubOptions(['radio_flusurv_recent', 'radio_flusurv_static', 'radio_flusurv_offset']);
            connectSubOptions(['radio_ilinet_default_version', 'radio_ilinet_specific_version']);
            connectSubOptions(['radio_nidss_flu_recent', 'radio_nidss_flu_static', 'radio_nidss_flu_offset']);
            connectSubOptions(['check_wiki_hour']);
            connectSubOptions(['check_date']);
            connectSubOptions(['check_group']);
            // top button bar
            setActionTooltip('file_csv',
               function() { openDialog('dialog_csv'); },
               'import dataset from local CSV file');
            setActionTooltip('file_api',
               function() { openDialog('dialog_api'); },
               'import dataset from Delphi API');
            setActionTooltip('file_draw',
               function() { openDialog('dialog_draw'); },
               'add a line manually');
            setActionTooltip('file_kernels',
               function() { openDialog('dialog_kernels'); },
               'create dataset via kernel function');
            setActionTooltip('file_tree',
               showLeftSection,
               'show or hide tree view');
            setActionTooltip('file_fullscreen',
               function() { screenfull.toggle(); },
               'toggle fullscreen mode');
            setActionTooltip('action_randomize',
               chartRandomizeColors,
               'randomize colors');
            setActionTooltip('action_autoscale',
               chartAutoScale,
               'fit data to screen');
            setActionTooltip('action_showpoints',
               chartShowPoints,
               'show or hide points');
            setActionTooltip('action_multiscale',
               multiScale,
               'scale by 1/mean');
            setActionTooltip('action_regress',
               function() {
                  fillRegressionDialog();
                  openDialog('dialog_regress');
               },
               'perform regression');
            setActionTooltip('action_reset',
               resetChart,
               'reset scaling and shifting');
            setActionTooltip('action_screenshot',
               screenshot,
               'take a screenshot');
            setActionTooltip('action_undo',
               chartUndo,
               'undo <span style="color: #d42">//not implemented</' + 'span>');
            setActionTooltip('action_redo',
               chartRedo,
               'redo <span style="color: #d42">//not implemented</' + 'span>');
            setActionTooltip('navmode_pan',
               function() { setNavMode(EpiVis.Chart.NavMode.pan); },
               'pan mode');
            setActionTooltip('navmode_crop',
               function() { setNavMode(EpiVis.Chart.NavMode.crop); },
               'crop mode');
            setActionTooltip('navmode_zoom',
               function() { setNavMode(EpiVis.Chart.NavMode.zoom); },
               'zoom mode');
            // escape key closes dialog
            $(document).keyup(function(e) { if (e.keyCode == 27) { closeDialog(); } });
            // dynamic resizing
            $(window).resize(resize);
            resize();
         }
         function setActionTooltip(id, action, tooltip) {
            var button = $('#' + id);
            button.click(function() { action(); hideTooltip(); });
            button.hover(showTooltip(tooltip), hideTooltip);
         }
         function showTooltip(message) {
            return function(event) {
               var bar = $('#top_bar');
               var tt = $('#tooltip');
               tt.html('<i class="fa fa-info-circle"></' + 'i>&nbsp;&nbsp;' + message);
               tt.css({top: bar.offset().top + bar.height(), left: event.pageX - tt.width() / 2, });
               tt.show(0);
            };
         }
         function hideTooltip(event) {
            $('#tooltip').hide(0);
         }
         function loadEpidata() {
            function successFunction(title) {
               return function(datasets) {
                  var info = new CSV.Info();
                  info.numCols = datasets.length;
                  info.numRows = datasets[0].data.length;
                  info.data = new CSV.DataGroup('[API] ' + title, datasets);
                  info.print();
                  var node = new TreeView.Node(info.data.getTitle());
                  loadDataGroup(node, info.data.getData());
                  tree.append(node);
                  closeDialog();
               }
            }
            function onFailure(message) {
               alert(message);
            }
            if($('#radio_fluview').is(':checked')) {
               (function() {
                  var region = $('#select_fluview_region :selected').val();
                  var title = 'FluView: ' + $('#select_fluview_region :selected').text();
                  var issue, lag;
                  if($('#radio_fluview_static').is(':checked')) {
                     issue = parseInt($('#text_fluview_static').val(), 10);
                     title += ' (reported ' + Math.floor(issue / 100) + 'w' + (issue % 100) + ')';
                  } else if($('#radio_fluview_offset').is(':checked')) {
                     lag = parseInt($('#text_fluview_offset').val(), 10);
                     title += ' (lagged ' + lag + ' week' + (lag != 1 ? 's' : '') + ')';
                  }
                  Epidata.fetchFluView(successFunction(title), onFailure, region, issue, lag);
               }());
            } else if($('#radio_flusurv').is(':checked')) {
               (function() {
                  var location = $('#select_flusurv_location :selected').val();
                  var title = 'FluSurv: ' + $('#select_flusurv_location :selected').text();
                  var issue, lag;
                  if($('#radio_flusurv_static').is(':checked')) {
                     issue = parseInt($('#text_flusurv_static').val(), 10);
                     title += ' (reported ' + Math.floor(issue / 100) + 'w' + (issue % 100) + ')';
                  } else if($('#radio_flusurv_offset').is(':checked')) {
                     lag = parseInt($('#text_flusurv_offset').val(), 10);
                     title += ' (lagged ' + lag + ' week' + (lag != 1 ? 's' : '') + ')';
                  }
                  Epidata.fetchFluSurv(successFunction(title), onFailure, location, issue, lag);
               }());
            } else if($('#radio_ilinet').is(':checked')) {
               (function() {
                  var auth = $('#text_ilinet_auth').val() || null;
                  var src = 'ILINet' + (auth ? '+' : '');
                  var location = $('#select_ilinet_location :selected').val();
                  var version = null, titleVersion = '';
                  if($('#radio_ilinet_specific_version').is(':checked')) {
                    version = parseInt($('#text_ilinet_specific_version').val(), 10);
                    titleVersion = ' (v' + version + ')';
                  }
                  var title = src + ': ' + $('#select_ilinet_location :selected').text() + titleVersion;
                  Epidata.fetchILINet(successFunction(title), onFailure, location, version, auth);
               }());
            } else if($('#radio_stateili').is(':checked')) {
               (function() {
                  var auth = $('#text_stateili_auth').val();
                  var state = $('#select_stateili_state :selected').val();
                  var title = 'StateILI: ' + $('#select_stateili_state :selected').text();
                  Epidata.fetchStateILI(successFunction(title), onFailure, auth, state);
               }());
            } else if($('#radio_gft').is(':checked')) {
               (function() {
                  var location = $('#select_gft_location :selected').val();
                  var title = 'GFT: ' + $('#select_gft_location :selected').text();
                  Epidata.fetchGFT(successFunction(title), onFailure, location);
               }());
            } else if($('#radio_ght').is(':checked')) {
               (function() {
                  var auth = $('#text_ght_auth').val();
                  var location = $('#select_ght_location :selected').val();
                  var query = $('#text_ght_query').val();
                  var title = 'GHT: ' + $('#select_ght_location :selected').text() + '[' + $('#text_ght_query').val() + ']';
                  Epidata.fetchGHT(successFunction(title), onFailure, auth, location, query);
               }());
            } else if($('#radio_twitter').is(':checked')) {
               (function() {
                  var auth = $('#text_twitter_auth').val();
                  var location = $('#select_twitter_location :selected').val();
                  var resolution = $('#select_twitter_resolution :selected').val();
                  var title = 'Twitter: ' + $('#select_twitter_location :selected').text() + ', ' + $('#select_twitter_resolution :selected').text();
                  Epidata.fetchTwitter(successFunction(title), onFailure, auth, location, resolution);
               }());
            } else if($('#radio_wiki').is(':checked')) {
               (function() {
                  var article = $('#select_wiki_article :selected').val();
                  var resolution = $('#select_wiki_resolution :selected').val();
                  var hour;
                  if($('#check_wiki_hour').is(':checked')) {
                     hour = parseInt($('#text_wiki_hour').val(), 10);
                  }
                  var title = 'Wiki: ' + $('#select_wiki_article :selected').text() + ', ' + $('#select_wiki_resolution :selected').text() + (typeof hour !== 'undefined' ? ' (hour=' + hour + ')' : '');
                  Epidata.fetchWiki(successFunction(title), onFailure, article, resolution, hour);
               }());
            } else if($('#radio_nidss_flu').is(':checked')) {
               (function() {
                  var region = $('#select_nidss_flu_region :selected').val();
                  var title = 'NIDSS-influenza: ' + $('#select_nidss_flu_region :selected').text();
                  var issue, lag;
                  if($('#radio_nidss_flu_static').is(':checked')) {
                     issue = parseInt($('#text_nidss_flu_static').val(), 10);
                     title += ' (reported ' + Math.floor(issue / 100) + 'w' + (issue % 100) + ')';
                  } else if($('#radio_nidss_flu_offset').is(':checked')) {
                     lag = parseInt($('#text_nidss_flu_offset').val(), 10);
                     title += ' (lagged ' + lag + ' week' + (lag > 1 ? 's' : '') + ')';
                  }
                  Epidata.fetchNIDSS_flu(successFunction(title), onFailure, region, issue, lag);
               }());
            } else if($('#radio_nidss_dengue').is(':checked')) {
               (function() {
                  var location = $('#select_nidss_dengue_location :selected').val();
                  var title = 'NIDSS-Dengue: ' + $('#select_nidss_dengue_location :selected').text();
                  Epidata.fetchNIDSS_dengue(successFunction(title), onFailure, location);
               }());
            } else if($('#radio_signals').is(':checked')) {
               (function() {
                  var auth = $('#text_signals_auth').val();
                  var name_v = $('#select_signals_name :selected').val();
                  var name_t = $('#select_signals_name :selected').text();
                  var location_v = $('#select_signals_location :selected').val();
                  var location_t = $('#select_signals_location :selected').text();
                  var title = 'Delphi ' + name_t + ' Signals: ' + location_t;
                  Epidata.fetchSignals(successFunction(title), onFailure, auth, name_v, location_v);
               }());
            } else if($('#radio_cdc').is(':checked')) {
               (function() {
                  var auth = $('#text_cdc_auth').val();
                  var location_v = $('#select_cdc_location :selected').val();
                  var location_t = $('#select_cdc_location :selected').text();
                  var title = 'CDC Page Hits: ' + location_t;
                  Epidata.fetchCDC(successFunction(title), onFailure, auth, location_v);
               }());
            } else if($('#radio_sensors').is(':checked')) {
               (function() {
                  var auth = $('#text_sensors_auth').val();
                  var name_v = $('#select_sensors_name :selected').val();
                  var name_t = $('#select_sensors_name :selected').text();
                  var location_v = $('#select_sensors_location :selected').val();
                  var location_t = $('#select_sensors_location :selected').text();
                  var title = 'Delphi Sensor ' + name_t + ': ' + location_t;
                  Epidata.fetchSensors(successFunction(title), onFailure, auth, name_v, location_v);
               }());
            } else if($('#radio_nowcast').is(':checked')) {
               (function() {
                  var location_v = $('#select_nowcast_location :selected').val();
                  var location_t = $('#select_nowcast_location :selected').text();
                  var title = 'Delphi Nowcast: ' + location_t;
                  Epidata.fetchNowcast(successFunction(title), onFailure, location_v);
               }());
            } else {
               alert('invalid api');
            }
         }
         function resize() {
            var canvas = $('#chart_canvas');
            var button = $('#file_fullscreen');
            canvas[0].width = canvas.width();
            canvas[0].height = canvas.height();
            chart.render();
            if(screenfull.enabled && (canvas.height() <= 480 || screenfull.isFullscreen)) {
               button.show();
            } else {
               button.hide();
            }
         }
         function showLeftSection(show) {
            var button = $('#file_tree');
            var canvas = $('#chart_canvas');
            var left = $('#chart_tree');
            show = (typeof show === 'undefined') ? !button.hasClass('ui_flag_icon_selected') : show;
            if(show) {
               canvas.removeClass('hide_left');
               canvas.addClass('show_left');
               button.addClass('ui_flag_icon_selected');
               left.show();
            } else {
               canvas.removeClass('show_left');
               canvas.addClass('hide_left');
               button.removeClass('ui_flag_icon_selected');
               left.hide();
            }
            resize();
         }
         function multiScale() {
            var [selected, nodenames] = tree.getSelectedDatasets();
            for(i = 0; i < selected.length; i++) {
               selected[i].scaleMean();
            }
            chart.render();
         }
         function runRegression(index) {
            var [selected, nodenames] = tree.getSelectedDatasets();
            if(selected.length<2)
               multiScale();
            else{
               for(i = 0; i < selected.length; i++) {
                  if(i==index) continue;
                  else selected[i].regress(selected[index]);
               }
               chart.render();
            }
            closeDialog();
         }

         function resetChart() {
            var [selected, nodenames] = tree.getSelectedDatasets();
            for(i = 0; i < selected.length; i++) {
               selected[i].scaleAndShift(1,0);
            }
            chart.render();
         }
         function screenshot() {
            window.open($('#chart_canvas')[0].toDataURL());
         }
         function chartAutoScale() {
            chart.autoScale(true);
         }
         function chartUndo() {
            //chart.multiScale();
            alert('undo is not implemented yet');
         }
         function chartRedo() {
            //chart.multiScale();
            alert('redo is not implemented yet');
         }
         function chartRandomizeColors() {
            chart.randomizeColors();
         }
         function chartShowPoints() {
            var cls = 'ui_flag_icon_selected';
            chart.showPoints();
            if(chart.isShowingPoints()) {
               $('#action_showpoints').addClass(cls);
            } else {
               $('#action_showpoints').removeClass(cls);
            }
         }
         function setNavMode(mode) {
            chart.setNavMode(mode);
         }
         function loadFile(action) {
            if($('#file_local')[0].files.length == 0) {
               return;
            }
            var file;
            try {
               file = $('#file_local')[0].files[0];
               if(file.type !== 'text/csv' && file.type !== 'application/vnd.ms-excel' && file.type !== 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet') {
                  if(!confirm('*Unknown file type.*\n\nBrowser reports mime type of [' + file.type + ']; expected [text/csv].\n\nAttempt to load anyway?')) {
                     return;
                  }
               }
               if(file.size > (1 << 20)) {
                  if(!confirm('*Large file.*\n\nBrowser reports file size of [' + file.size + ' bytes].\n\nAttempt to load anyway?')) {
                     return;
                  }
               }
            } catch(e) {
               alert(e + '\n(Hint: Double check that you selected the right file.)');
            }
            var reader = new FileReader();
            reader.onload = function(e) {
               console.log('Loaded ' + reader.result.length + ' bytes');
               action(reader.result);
            }
            reader.onerror = function(e) {
               alert('Failed to read file: ' + reader.error);
            }
            reader.readAsText(file);
         }
         function getCSVOptions() {
            var options = new CSV.Options();
            options.transpose = $('#check_transpose').is(':checked');
            options.hasHeader = $('#check_header').is(':checked');
            if($('#check_date').is(':checked')) {
               if($('#radio_simple').is(':checked')) {
                  options.dateType = CSV.Options.DateType.Simple;
                  options.dateCol1 = parseInt($('#text_simple_0').val(), 10);
                  options.dateFormat = 'YYYY-MM-DD';
               }
               if($('#radio_epiweek').is(':checked')) {
                  options.dateType = CSV.Options.DateType.Epiweek;
                  options.dateCol1 = parseInt($('#text_epiweek_0').val(), 10);
               }
               if($('#radio_epi').is(':checked')) {
                  options.dateType = CSV.Options.DateType.Epi;
                  options.dateCol1 = parseInt($('#text_epi_0').val(), 10);
                  options.dateCol2 = parseInt($('#text_epi_1').val(), 10);
               }
               if($('#radio_decimal').is(':checked')) {
                  options.dateType = CSV.Options.DateType.Decimal;
                  options.dateCol1 = parseInt($('#text_decimal_0').val(), 10);
               }
               if($('#radio_monthly').is(':checked')) {
                  options.dateType = CSV.Options.DateType.Monthly;
                  options.dateCol1 = parseInt($('#text_monthly_0').val(), 10);
                  options.dateCol2 = parseInt($('#text_monthly_1').val(), 10);
               }
            } else {
               options.dateType = null;
            }
            options.hasGroup = $('#check_group').is(':checked');
            if(options.hasGroup) {
               options.groupColumn = parseInt($('#text_group_0').val(), 10);
            }
            options.print();
            return options;
         }
         function parseFile(text) {
            var options;
            var info = text.split('\n')[0].trim();
            if(info.startsWith('#{') && info.endsWith('}')) {
               options = JSON.parse(info.substring(1));
               console.log('using CSVOptions from file');
            } else {
               options = getCSVOptions();
               console.log(JSON.stringify(options));
            }
            var title = $('#file_local')[0].files[0].name;
            var csv = CSV.read(title, text, options);
            var node = new TreeView.Node(csv.data.getTitle());
            var data = csv.data.getData();
            loadDataGroup(node, data);
            tree.append(node);
            closeDialog();
         }
         function previewFile(text) {
            var lines = text.split('\n');
            var preview = '';
            var i;
            for(i = 0; i < Math.min(5, lines.length); i++) {
              preview += lines[i] + '\n';
            }
            $('#preview_box').val(preview);
            var info = lines[0].trim();
            if(info.startsWith('#{') && info.endsWith('}')) {
               parseFile(text);
            }
         }
         function loadDataGroup(node, data) {
            var nodes = [];
            var group0, i, j, n;
            if(typeof data[0].group !== 'undefined') {
               group0 = data[0].getData();
               for(i = 0; i < group0.length; i++) {
                  n = new TreeView.Node('[all] ' + group0[i].title, node);
                  n.setDataset(0, function(i) { return function(node) {
                     for(j = 0; j < data.length; j++) {
                        if(node.isSelected()) {
                           chart.addDataset(data[j].getData()[i]);
                        } else {
                           chart.removeDataset(data[j].getData()[i]);
                        }
                     }
                  };}(i));
                  nodes.push(n);
               }
            }
            for(var i = 0; i < data.length; i++) {
               if(typeof data[i].group === 'undefined') {
                  // this is an actual dataset
                  var n = new TreeView.Node(data[i].title, node);
                  n.setDataset(data[i], nodeToggled);
                  nodes.push(n);
               } else {
                  // this is just a container
                  var n = new TreeView.Node(data[i].getTitle(), node);
                  loadDataGroup(n, data[i].getData());
                  nodes.push(n);
               }
            }
            node.setNodes(nodes);
         }
         function nodeToggled(node) {
            if(node.isLeaf()) {
               if(node.isSelected()) {
                  chart.addDataset(node.getDataset());
               } else {
                  chart.removeDataset(node.getDataset());
               }
            }
         }
         function updateDatePresent() {
            if($('#check_date').is(':checked')) {
               $('#check_date_options').show(200);
            } else {
               $('#check_date_options').hide(200);
            }
         }
         function updateGroupPresent() {
            if($('#check_group').is(':checked')) {
               $('#check_group_options').show(200);
            } else {
               $('#check_group_options').hide(200);
            }
         }
         function connectSubOptions(labels) {
            var update = function() {
               for(var i = 0; i < labels.length; i++) {
                  if($('#' + labels[i]).is(':checked')) {
                     $('#' + labels[i] + '_options').show(200);
                  } else {
                     $('#' + labels[i] + '_options').hide(200);
                  }
               }
            };
            for(var i = 0; i < labels.length; i++) {
               $('#' + labels[i]).click(update);
            }
         }
         function addCustomLine() {
            var parseDate = function(date) {
               if(date.length === 6) {
                  var d = parseInt(date);
                  if(!isNaN(d)) {
                     return EpiVis.Date.fromEpiweek(Math.floor(d / 100), d % 100);
                  }
               } else {
                  try {
                     return EpiVis.Date.parse(date);
                  } catch (ex) {
                  }
               }
               return null;
            };
            var title = $('#draw_title').val();
            var date1 = parseDate($('#draw_date1').val());
            var date2 = parseDate($('#draw_date2').val());
            if(date1 === null || date2 === null) {
               alert('Invalid date string.');
               return;
            }
            var value1 = parseFloat($('#draw_value1').val());
            var value2 = parseFloat($('#draw_value2').val());
            if(isNaN(value1) || isNaN(value2)) {
               alert('Invalid float value.');
               return;
            }
            var dataset = new EpiVis.Dataset([new EpiVis.Point(date1, value1), new EpiVis.Point(date2, value2)], title);
            var node = new TreeView.Node(title);
            node.setDataset(dataset, nodeToggled);
            tree.append(node);
            closeDialog();
         }
         function createDataset(title, kernel) {
            if(typeof kernel === 'undefined' || kernel === null) {
               alert('You need to pass a kernel function like:\n[date, double] kernel(EpiVis.Date date, double[] values)');
               return;
            }
            var selected = tree.getSelectedDatasets();
            if(selected.length === 0) {
               alert('You need to select at least one dataset.');
               return;
            }
            console.log('Using these datasets:');
            for(var i = 0; i < selected.length; i++) {
               console.log('   ' + selected[i].title);
            }
            // find the union of dates
            var values = {};
            for(var ds = 0; ds < selected.length; ds++) {
               for(var i = 0; i < selected[ds].data.length; i++) {
                  var point = selected[ds].data[i];
                  var idx = point.getDate().getIndex();
                  values[idx] = values[idx] || {};
                  values[idx][ds] = point.getValue();
               }
            }
            var indices = [];
            for(var idx in values) {
               if (values.hasOwnProperty(idx)) {
                  indices.push(parseInt(idx));
               }
            }
            indices.sort(function(x, y){return x - y;});
            var data = [];
            for(var i = 0; i < indices.length; i++) {
               var idx = indices[i];
               var date = EpiVis.Date.fromIndex(idx);
               var vals = [];
               for(var ds = 0; ds < selected.length; ds++) {
                  //todo: use interpolation if necessary
                  vals.push(values[idx][ds] || null);
               }
               var result = kernel(date, vals);
               data.push(new EpiVis.Point(result[0], result[1]));
            }
            var node = new TreeView.Node(title);
            var dataset = new EpiVis.Dataset(data, title);
            node.setDataset(dataset, nodeToggled);
            tree.append(node);
         }
         var chartListener = {
            onNavModeChanged: function(navMode) {
               var cls = 'ui_flag_icon_selected';
               $('#navmode_pan').removeClass(cls);
               $('#navmode_crop').removeClass(cls);
               $('#navmode_zoom').removeClass(cls);
               switch(navMode) {
                  case EpiVis.Chart.NavMode.pan: {
                     $('#navmode_pan').addClass(cls);
                  } break;
                  case EpiVis.Chart.NavMode.crop: {
                     $('#navmode_crop').addClass(cls);
                  } break;
                  case EpiVis.Chart.NavMode.zoom: {
                     $('#navmode_zoom').addClass(cls);
                  } break;
               }
            }
         };
         var Kernels = {
            sum: function() {
               return function(date, values) {
                  var sum = 0;
                  for(var i = 0; i < values.length; i++) { sum += values[i]; }
                  return [date, sum];
               };
            },
            product: function() {
               return function(date, values) {
                  var product = 1;
                  for(var i = 0; i < values.length; i++) { product *= values[i]; }
                  return [date, product];
               };
            },
            average: function() {
               return function(date, values) {
                  var sum = 0;
                  for(var i = 0; i < values.length; i++) { sum += values[i]; }
                  return [date, sum / values.length];
               };
            },
            ratio: function(inverse) {
               return function(date, values) {
                  var a, b;
                  if(inverse) {
                     a = values[1];
                     b = values[0];
                  } else {
                     a = values[0];
                     b = values[1];
                  }
                  return [date, b == 0 ? 0 : a / b];
               };
            },
            scale: function(scale) {
               return function(date, values) {
                  return [date, values[0] * scale];
               };
            },
            iliplus: function() {
               return function(date, values) {
                  return [date, (values[0] * values[1]) / 100];
               };
            },
         };
         function openDialog(name) {
            currentDialog = name;
            $('#box_overlay').show(0, function() {
               $('#box_overlay').animate({ opacity: 0.9, }, 200);
            });
            $('#' + name).show(0, function() {
               $('#' + name).animate({ opacity: 1, }, 200);
            });
         }
         function closeDialog() {
            if(currentDialog === null) {
               return;
            }
            var name = currentDialog;
            currentDialog = null;
            $('#box_overlay').animate({ opacity: 0, }, 200, function() {
               $('#box_overlay').hide();
            });
            $('#' + name).animate({ opacity: 0, }, 200, function() {
               $('#' + name).hide();
            });
         }
         function fillRegressionDialog() {
            var [selected, nodenames] = tree.getSelectedDatasets();
            //var dropdown = $("#regress_dropdown");
            $('#regress_dropdown').empty();
            $.each(nodenames, function (i, name) {
               $('#regress_dropdown').append($('<option>', {
                  value: i,
                  text : name
               }));
            });
         }

         $(document).ready(run);
      </script>
   </body>
</html>
